<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HANCA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
  </head>

  <button x-data @click="$store.hanca.openTambah()">open</button>
  <button x-data @click="$store.hanca.openEdit()">open</button>

  <body>
    <div x-data x-show="$store.hanca.modal">
      <form x-data x-on:submit.prevent="$store.hanca.tambahHanca()">
        <label for="nama_barang">Nama Barang</label>
        <input type="text" id="nama_barang" x-model="$store.hanca.namaHanca" />
        <label for="kategori">Kategori</label>
        <select id="kategori" x-model="$store.hanca.kategoriHanca">
          <option value="" disabled selected>kategori hanca</option>
          <template x-for="kategori in $store.hanca.kategoris">
            <option :value="kategori.index" x-text="kategori.namaKategori">
              kategoriku
            </option>
          </template>
        </select>
        <label for="hal/eps">halaman/episode saat ini</label>
        <input type="number" id="hal/eps" x-model="$store.hanca.jumlahHanca" />
        <button>tambah hanca</button>
      </form>
    </div>

    <div x-data x-show="$store.hanca.modal">
      <form x-data x-on:submit.prevent="$store.hanca.simpanUbahHanca()">
        <label for="nama_barang">Nama Barang</label>
        <input type="text" id="nama_barang" x-model="$store.hanca.namaHanca" />
        <label for="kategori">Kategori</label>
        <select id="kategori" x-model="$store.hanca.kategoriHanca">
          <option value="" disabled selected>kategori hanca</option>
          <template x-for="kategori in $store.hanca.kategoris">
            <option :value="kategori.index" x-text="kategori.namaKategori">
              kategoriku
            </option>
          </template>
        </select>
        <label for="hal/eps">halaman/episode saat ini</label>
        <input type="number" id="hal/eps" x-model="$store.hanca.jumlahHanca" />
        <button>edit hanca</button>
      </form>
    </div>

    <template x-data x-if="$store.hanca.hancas.length">
      <template x-for="item in $store.hanca.hancas" :key="item.id">
        <div class="border mb-4">
          <p x-text="item.hanca"></p>
          <p x-text="item.kategori.namaKategori"></p>
          <p x-text="item.jumlah"></p>
          <div>
            <button x-on:click="$store.hanca.ubahHanca(item.id)">edit</button>
          </div>
        </div>
      </template>
    </template>

    <button x-data x-on:click="$store.hanca.hapusSemuaHanca()">reset</button>

    <script>
      document.addEventListener("alpine:init", () => {
        Alpine.store("hanca", {
          //kumpulan data
          //persist hancas
          hancas: Alpine.$persist([]),

          //data toggle element
          modal: false,
          modalUbah: false,
          modalTambah: false,

          //data fix
          kategoris: [
            {
              index: 0,
              namaKategori: "buku",
            },
            {
              index: 1,
              namaKategori: "film",
            },
          ],

          //data model input form
          namaHanca: "",
          kategoriHanca: "",
          jumlahHanca: "",

          //data ambil id hanca
          idHanca: "",

          //kumpulan fungsi
          //fungsi toggle modal
          openTambah() {
            this.modal = !this.modal;
          },

          openEdit() {
            this.modal = !this.modal;
          },

          //fungsi terkait form
          //validasiform
          validasiHanca() {
            if (!this.namaHanca) {
              alert("isi nama hanca terlebih dahulu");
              console.log(this.hancas);
              return false;
            }
            if (!this.kategoriHanca) {
              alert("pilih kategori hanca terlebih dahulu");
              return false;
            }
            if (!this.jumlahHanca) {
              alert("isi halaman/episode terlebih dahulu");
              return false;
            }
            return true;
          },

          //membersihkan isi input form
          membersihkanForm() {
            this.namaHanca = "";
            this.kategoriHanca = "";
            this.jumlahHanca = "";
          },

          //tambah hanca
          tambahHanca() {
            if (this.validasiHanca()) {
              this.hancas.push({
                id: Date.now(),
                hanca: this.namaHanca,
                kategori: this.kategoris[this.kategoriHanca],
                jumlah: this.jumlahHanca,
              });
              this.membersihkanForm();
            }
          },

          //ambil data berdasarkan id dan toggle modal
          ubahHanca(id) {
            if (!this.namaHanca) {
              this.namaHanca = this.hancas.filter(
                (item) => item.id == id
              )[0].hanca;
              this.kategoriHanca = this.kategoris.filter(
                (item) =>
                  item.namaKategori ==
                  this.hancas.filter((item) => item.id == id)[0].kategori
                    .namaKategori
              )[0].index;
              this.jumlahHanca = this.hancas.filter(
                (item) => item.id == id
              )[0].jumlah;
              this.idHanca = id;
            } else {
              this.clearForm();
              this.idHanca = "";
              console.log(this.idHanca);
            }
          },

          //simpan perubahan hanca
          simpanUbahHanca() {
            if (this.validasiHanca()) {
              let index = this.hancas.findIndex(
                (item) => item.id == this.idHanca
              );
              this.hancas.splice(index, 1, {
                id: this.idHanca,
                hanca: this.namaHanca,
                kategori: this.kategoris[this.kategoriHanca],
                jumlah: this.jumlahHanca,
              });
              this.membersihkanForm()
            }
          },

          //fungsi tidak terkait form
          //hapusSemuaHanca
          hapusSemuaHanca() {
            if (confirm("hapus hanca?")) {
              this.hancas = [];
            }
          },
        });
      });
    </script>
  </body>
</html>
